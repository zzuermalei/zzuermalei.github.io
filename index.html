<!DOCTYPE html>













<html class="theme-next muse" lang="zh-CN">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2"/>
<meta name="theme-color" content="#222">












<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />






















<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=6.4.0" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=6.4.0">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=6.4.0">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=6.4.0">


  <link rel="mask-icon" href="/images/logo.svg?v=6.4.0" color="#222">









<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Muse',
    version: '6.4.0',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: false,
    fastclick: false,
    lazyload: false,
    tabs: true,
    motion: {"enable":false,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>


  




  <meta name="description" content="iOS小白一枚，写这个博客，首先是为了总结，通过写作来提高自己的写作和表达能力。其次是想把自己理解的东西分享给大家，与大家进行交流，也希望大家可以指出我的不足并提供宝贵的意见！">
<meta property="og:type" content="website">
<meta property="og:title" content="小马同学的技术博客">
<meta property="og:url" content="http://yoursite.com/index.html">
<meta property="og:site_name" content="小马同学的技术博客">
<meta property="og:description" content="iOS小白一枚，写这个博客，首先是为了总结，通过写作来提高自己的写作和表达能力。其次是想把自己理解的东西分享给大家，与大家进行交流，也希望大家可以指出我的不足并提供宝贵的意见！">
<meta property="og:locale" content="zh-CN">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="小马同学的技术博客">
<meta name="twitter:description" content="iOS小白一枚，写这个博客，首先是为了总结，通过写作来提高自己的写作和表达能力。其次是想把自己理解的东西分享给大家，与大家进行交流，也希望大家可以指出我的不足并提供宝贵的意见！">






  <link rel="canonical" href="http://yoursite.com/"/>



<script type="text/javascript" id="page.configurations">
  CONFIG.page = {
    sidebar: "",
  };
</script>

  <title>小马同学的技术博客</title>
  









  <noscript>
  <style type="text/css">
    .use-motion .motion-element,
    .use-motion .brand,
    .use-motion .menu-item,
    .sidebar-inner,
    .use-motion .post-block,
    .use-motion .pagination,
    .use-motion .comments,
    .use-motion .post-header,
    .use-motion .post-body,
    .use-motion .collection-title { opacity: initial; }

    .use-motion .logo,
    .use-motion .site-title,
    .use-motion .site-subtitle {
      opacity: initial;
      top: initial;
    }

    .use-motion {
      .logo-line-before i { left: initial; }
      .logo-line-after i { right: initial; }
    }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-CN">

  
  
    
  

  <div class="container sidebar-position-left 
  page-home">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">小马同学的技术博客</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
    
      
        <p class="site-subtitle">Stay hungry. Stay Foolish. - Steve Jobs. 求知若渴，虚心若愚！</p>
      
    
  </div>

  <div class="site-nav-toggle">
    <button aria-label="切换导航栏">
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>



<nav class="site-nav">
  
    <ul id="menu" class="menu">
      
        
        
        
          
          <li class="menu-item menu-item-home menu-item-active">
    <a href="/" rel="section">
      <i class="menu-item-icon fa fa-fw fa-home"></i> <br />首页</a>
  </li>
        
        
        
          
          <li class="menu-item menu-item-tags">
    <a href="/tags/" rel="section">
      <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />标签</a>
  </li>
        
        
        
          
          <li class="menu-item menu-item-categories">
    <a href="/categories/" rel="section">
      <i class="menu-item-icon fa fa-fw fa-th"></i> <br />分类</a>
  </li>
        
        
        
          
          <li class="menu-item menu-item-archives">
    <a href="/archives/" rel="section">
      <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />归档</a>
  </li>
        
        
        
          
          <li class="menu-item menu-item-about">
    <a href="/about/" rel="section">
      <i class="menu-item-icon fa fa-fw fa-user"></i> <br />关于</a>
  </li>

      
      
    </ul>
  

  
    

  

  
</nav>



  



</div>
    </header>

    


    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/12/02/8.theos/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="小马同学">
      <meta itemprop="description" content="iOS小白一枚，写这个博客，首先是为了总结，通过写作来提高自己的写作和表达能力。其次是想把自己理解的东西分享给大家，与大家进行交流，也希望大家可以指出我的不足并提供宝贵的意见！">
      <meta itemprop="image" content="/images/avatar.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="小马同学的技术博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/12/02/8.theos/" itemprop="url">
                  theos
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2018-12-02 00:31:42 / 修改时间：01:02:06" itemprop="dateCreated datePublished" datetime="2018-12-02T00:31:42+08:00">2018-12-02</time>
            

            
              

              
            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/逆向实战/" itemprop="url" rel="index"><span itemprop="name">逆向实战</span></a></span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          Welcome to my blog, enter password to read.
          <!--noindex-->
          <div class="post-button text-center">
            <a class="btn" href="/2018/12/02/8.theos/#more" rel="contents">
              阅读全文 &raquo;
            </a>
          </div>
          <!--/noindex-->
        
      
    </div>

    

    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/11/25/7.加壳脱壳/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="小马同学">
      <meta itemprop="description" content="iOS小白一枚，写这个博客，首先是为了总结，通过写作来提高自己的写作和表达能力。其次是想把自己理解的东西分享给大家，与大家进行交流，也希望大家可以指出我的不足并提供宝贵的意见！">
      <meta itemprop="image" content="/images/avatar.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="小马同学的技术博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/11/25/7.加壳脱壳/" itemprop="url">
                  加壳脱壳
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2018-11-25 04:04:33 / 修改时间：05:10:23" itemprop="dateCreated datePublished" datetime="2018-11-25T04:04:33+08:00">2018-11-25</time>
            

            
              

              
            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/逆向实战/" itemprop="url" rel="index"><span itemprop="name">逆向实战</span></a></span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>iOS | 加壳脱壳 | Objective-C</p>
<h2><span id="1加壳">1.加壳</span></h2><p><img src="/2018/11/25/7.加壳脱壳/加壳_1.png" alt="加壳_1"></p>
<hr>
<p><strong>什么是加壳 ?</strong><br>利用特殊的算法，对可执行文件的编码进行改变（比如压缩、加密），以达到保护程序代码的目的<br><img src="/2018/11/25/7.加壳脱壳/加壳_2.png" alt="加壳_2"></p>
<h2><span id="2-脱壳">2. 脱壳</span></h2><ul>
<li><p>什么是脱壳？<br>摘掉壳程序，将未加密的可执行文件还原出来（有些人也称为“砸壳”）</p>
</li>
<li><p>脱壳主要有2种方法：硬脱壳、动态脱壳<br><img src="/2018/11/25/7.加壳脱壳/脱壳.png" alt="脱壳"></p>
</li>
</ul>
<h2><span id="3ios中的脱壳工具">3.iOS中的脱壳工具</span></h2><ul>
<li>iOS中有很多好用的脱壳工具<ul>
<li>Clutch：<a href="https://github.com/KJCracks/Clutch" target="_blank" rel="noopener">https://github.com/KJCracks/Clutch</a></li>
<li>dumpdecrypted: <a href="https://github.com/stefanesser/dumpdecrypted/" target="_blank" rel="noopener">https://github.com/stefanesser/dumpdecrypted/</a></li>
<li>AppCrackr、Crackulous</li>
</ul>
</li>
</ul>
<h2><span id="4-如何验证可执行文件是否已经脱壳">4. 如何验证可执行文件是否已经脱壳？</span></h2><ul>
<li><p>查看Load Commands -&gt; LC_ENCRYPTION_INFO -&gt; Crypt ID的值，<strong>0</strong> 代表 <strong>未加密</strong><br><img src="/2018/11/25/7.加壳脱壳/验证是否脱壳.png" alt="验证是否脱壳"></p>
</li>
<li><p>通过otool命令行也可以：<strong>otool   -l   可执行文件路径   |   grep   crypt</strong> </p>
</li>
</ul>
<h2><span id="5clutch-配置">5.Clutch - 配置</span></h2><ul>
<li><p>下载最新的Release版： <a href="https://github.com/KJCracks/Clutch/releases" target="_blank" rel="noopener">https://github.com/KJCracks/Clutch/releases</a><br><img src="/2018/11/25/7.加壳脱壳/Clutch_1.png" alt="Clutch_1"></p>
</li>
<li><p>建议去掉版本号，改名为Clutch<br><img src="/2018/11/25/7.加壳脱壳/Clutch_2.png" alt="Clutch_2"></p>
</li>
<li><p>将Clutch文件拷贝到iPhone的/usr/bin目录<br><img src="/2018/11/25/7.加壳脱壳/Clutch_3.png" alt="Clutch_3"></p>
</li>
<li><p>如果在iPhone上执行Clutch指令，权限不够，赋予“可执行的权限”<br><img src="/2018/11/25/7.加壳脱壳/Clutch_4.png" alt="Clutch_4"></p>
</li>
</ul>
<h2><span id="6clutch-使用">6.Clutch – 使用</span></h2><ul>
<li><p>列出已安装的APP：Clutch -i<br><img src="/2018/11/25/7.加壳脱壳/Clutch使用_1.png" alt="Clutch使用_1"></p>
</li>
<li><p>输入APP序号或者Bundle Id进行脱壳操作：<strong>Clutch -d APP序号或BundleId</strong><br><img src="/2018/11/25/7.加壳脱壳/Clutch使用_2.png" alt="Clutch使用_2"></p>
</li>
<li><p>脱壳成功后会生成一个ipa文件<br><img src="/2018/11/25/7.加壳脱壳/Clutch使用_3.png" alt="Clutch使用_3"></p>
</li>
</ul>
<h2><span id="7dumpdecrypted">7.dumpdecrypted</span></h2><ul>
<li><p>下载源代码，然后在源代码目录执行make指令进行编译，获得dylib动态库文件<br><img src="/2018/11/25/7.加壳脱壳/dumpdecrypted_1.png" alt="dumpdecrypted_1"></p>
</li>
<li><p>将dylib文件拷贝到iPhone上（如果是root用户，建议放 <strong>/var/root</strong> 目录）</p>
</li>
<li>终端进入dylib所在的目录</li>
<li>使用环境变量 <strong>DYLD_INSERT_LIBRARIES</strong> 将dylib注入到需要脱壳的可执行文件（可执行文件路径可以通过ps -A查看获取）</li>
<li><p><strong>DYLD_INSERT_LIBRARIES=dumpdecrypted.dylib   可执行文件路径</strong><br><img src="/2018/11/25/7.加壳脱壳/dumpdecrypted_2.png" alt="dumpdecrypted_2"></p>
</li>
<li><p>.decrypted文件就是脱壳后的可执行文件<br><img src="/2018/11/25/7.加壳脱壳/dumpdecrypted_3.png" alt="dumpdecrypted_3"></p>
</li>
</ul>
<hr>
<ul>
<li><p>在使用过程中，可能会遇到以下错误:<br><img src="/2018/11/25/7.加壳脱壳/dumpdecrypted_4.png" alt="dumpdecrypted_4"></p>
</li>
<li><p>原因：对dylib所在的文件夹权限不够</p>
</li>
<li>解决方案：将dylib放在用户所在文件夹，比如</li>
<li>如果是root用户，请将dylib放在/var/root目录</li>
<li>如果是mobile用户，请将dylib放在/var/mobile目录</li>
</ul>

          
        
      
    </div>

    

    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/11/04/6.Mach-O/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="小马同学">
      <meta itemprop="description" content="iOS小白一枚，写这个博客，首先是为了总结，通过写作来提高自己的写作和表达能力。其次是想把自己理解的东西分享给大家，与大家进行交流，也希望大家可以指出我的不足并提供宝贵的意见！">
      <meta itemprop="image" content="/images/avatar.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="小马同学的技术博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/11/04/6.Mach-O/" itemprop="url">
                  Mach-O
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2018-11-04 16:11:44" itemprop="dateCreated datePublished" datetime="2018-11-04T16:11:44+08:00">2018-11-04</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">更新于</span>
                
                <time title="修改时间：2018-11-25 04:06:11" itemprop="dateModified" datetime="2018-11-25T04:06:11+08:00">2018-11-25</time>
              
            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/逆向实战/" itemprop="url" rel="index"><span itemprop="name">逆向实战</span></a></span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>iOS | Mach-O | Objective-C</p>
<h2><span id="1app从开发到安装到手机的过程">1.APP从开发到安装到手机的过程</span></h2><p><img src="/2018/11/04/6.Mach-O/APP从开发到安装到手机_1.png" alt="APP从开发到安装到手机_1"></p>
<p><img src="/2018/11/04/6.Mach-O/APP从开发到安装到手机_2.png" alt="APP从开发到安装到手机_2"></p>
<h2><span id="2逆向app的思路">2.逆向APP的思路</span></h2><ul>
<li><p>界面分析<br>Cycript、Reveal</p>
</li>
<li><p>代码分析<br>1&gt; 对Mach-O文件的静态分析<br>2&gt; MachOView、class-dump、Hopper Disassembler、ida等</p>
</li>
<li><p>动态调试<br>1&gt; 对运行中的APP进行代码调试<br>2&gt; debugserver、LLDB</p>
</li>
<li><p>代码编写<br>1&gt; 注入代码到APP中<br>2&gt; 必要时还可能需要重新签名、打包ipa</p>
</li>
</ul>
<h2><span id="3class-dump">3.class-dump</span></h2><ul>
<li><p>顾名思义，它的作用就是把Mach-O文件的class信息给dump出来（把类信息给导出来），生成对应的.h头文件</p>
</li>
<li><p>官方地址：<a href="http://stevenygard.com/projects/class-dump/" target="_blank" rel="noopener">http://stevenygard.com/projects/class-dump/</a><br><img src="/2018/11/04/6.Mach-O/class-dump.png" alt="class-dump"></p>
</li>
<li><p>下载完工具包后将class-dump文件复制到Mac的/usr/local/bin目录，这样在终端就能识别class-dump命令了</p>
</li>
<li><p>常用格式<br>1&gt; <strong>class-dump  -H  Mach-O文件路径  -o  头文件存放目录</strong><br>2&gt; -H表示要生成头文件<br>3&gt; -o用于制定头文件的存放目录</p>
</li>
</ul>
<h2><span id="4代码的编译过程">4.代码的编译过程</span></h2><p><img src="/2018/11/04/6.Mach-O/代码编译过程_1.png" alt="代码编译过程_1"></p>
<p><strong>不同的OC代码，编译出来的汇编代码可能是一样的:</strong><br><img src="/2018/11/04/6.Mach-O/代码编译过程_2.png" alt="代码编译过程_2"></p>
<h2><span id="5hopper-disassmbler">5.Hopper Disassmbler</span></h2><ul>
<li><p>Hopper Disassmbler能够将Mach-O文件的机器语言代码反编译成汇编代码、OC伪代码或者Swift伪代码</p>
</li>
<li><p>常用快捷键<br>找出哪里引用了这个方法：<strong>Shift + Option + X</strong></p>
</li>
</ul>
<h2><span id="6动态库共享缓存dyld-shared-cache">6.动态库共享缓存（dyld shared cache）</span></h2><ul>
<li><p>从iOS3.1开始，为了提高性能，绝大部分的系统动态库文件都打包存放到了一个缓存文件中（dyld shared cache）<br>缓存文件路径：/System/Library/Caches/com.apple.dyld/dyld_shared_cache_arm<strong>X</strong></p>
</li>
<li><p>dyld_shared_cache_arm<strong>X</strong>的<strong>X</strong>代表ARM处理器指令集架构</p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">v6</span><br><span class="line">iPhone、iPhone3G</span><br><span class="line">iPod Touch、iPod Touch2</span><br><span class="line"></span><br><span class="line">v7</span><br><span class="line">iPhone3GS、iPhone4、iPhone4S</span><br><span class="line">iPad、iPad2、iPad3(The New iPad)</span><br><span class="line">iPad mini</span><br><span class="line">iPod Touch3G、iPod Touch4、iPod Touch5</span><br><span class="line"></span><br><span class="line">v7s</span><br><span class="line">iPhone5、iPhone5C</span><br><span class="line">iPad4</span><br><span class="line"></span><br><span class="line">arm64</span><br><span class="line">iPhone5S、iPhone6、iPhone6 Plus、iPhone6S、iPhone6S Plus</span><br><span class="line">iPhoneSE、iPhone7、iPhone7 Plus、iPhone8、iPhone8 Plus、iPhoneX、iPhoneXR、iPhoneXS</span><br><span class="line">iPad5、iPad Air、iPad Air2、iPad Pro、iPad Pro2</span><br><span class="line">iPad mini with Retina display、iPad mini3、iPad mini4</span><br><span class="line">iPod Touch6</span><br></pre></td></tr></table></figure>
</li>
<li><p>所有指令集原则上都是向下兼容的</p>
</li>
<li>动态库共享缓存一个非常明显的好处是节省内存</li>
<li>现在的ida、Hopper反编译工具都可以识别动态库共享缓存</li>
</ul>
<p><img src="/2018/11/04/6.Mach-O/动态库共享缓存.png" alt="动态库共享缓存"></p>
<h2><span id="7动态库的加载">7.动态库的加载</span></h2><ul>
<li><p>在Mac/iOS中，是使用了/usr/lib/dyld程序来加载动态库<br><strong>dyld:</strong><br>1&gt; dynamic link editor，动态链接编辑器<br>2&gt; dynamic loader，动态加载器</p>
</li>
<li><p>dyld源码<br><a href="https://opensource.apple.com/tarballs/dyld/" target="_blank" rel="noopener">https://opensource.apple.com/tarballs/dyld/</a></p>
</li>
</ul>
<h2><span id="8从动态库共享缓存抽取动态库">8.从动态库共享缓存抽取动态库</span></h2><ul>
<li>可以使用 dyld 源码中的 <strong>launch-cache/dsc_extractor.cpp</strong><br>1&gt; 将#if 0前面的代码删除（包括#if 0），把最后面的#endif也删掉<br>2&gt; 编译dsc_extractor.cpp<br><strong>clang++ -o dsc_extractor dsc_extractor.cpp</strong><br>3&gt; 使用dsc_extractor<br><strong>./dsc_extractor  动态库共享缓存文件的路径   用于存放抽取结果的文件夹</strong></li>
</ul>
<h2><span id="9mach-o">9.Mach-O</span></h2><ul>
<li><p>Mach-O是Mach object的缩写，是Mac\iOS上用于存储程序、库的标准格式</p>
</li>
<li><p>属于Mach-O格式的文件类型有<br><img src="/2018/11/04/6.Mach-O/Mach-O_Type.png" alt="Mach-O_Type"></p>
</li>
<li><p>可以在xnu源码中，查看到Mach-O格式的详细定义: <a href="https://opensource.apple.com/tarballs/xnu/" target="_blank" rel="noopener">https://opensource.apple.com/tarballs/xnu/</a><br>1&gt; EXTERNAL_HEADERS/mach-o/fat.h<br>2&gt; EXTERNAL_HEADERS/mach-o/loader.h</p>
</li>
</ul>
<hr>
<p><strong>常见的Mach-O文件类型：</strong></p>
<ul>
<li><p><strong>MH_OBJECT</strong><br>1&gt; 目标文件（.o）<br>2&gt; 静态库文件(.a），静态库其实就是N个.o合并在一起</p>
</li>
<li><p><strong>MH_EXECUTE</strong>：可执行文件<br>.app/xx</p>
</li>
<li><p><strong>MH_DYLIB</strong>：动态库文件<br>1&gt; .dylib<br>2&gt; .framework/xx</p>
</li>
<li><p><strong>MH_DYLINKER</strong>：动态链接编辑器<br>/usr/lib/dyld</p>
</li>
<li><p><strong>MH_DSYM</strong>：存储着二进制文件符号信息的文件<br>.dSYM/Contents/Resources/DWARF/xx（常用于分析APP的崩溃信息）</p>
</li>
</ul>
<h2><span id="10mach-o的基本结构">10.Mach-O的基本结构</span></h2><ul>
<li><p>官方描述<br><a href="https://developer.apple.com/library/content/documentation/DeveloperTools/Conceptual/MachOTopics/0-Introduction/introduction.html" target="_blank" rel="noopener">https://developer.apple.com/library/content/documentation/DeveloperTools/Conceptual/MachOTopics/0-Introduction/introduction.html</a></p>
</li>
<li><p>一个Mach-O文件包含3个主要区域<br>1&gt; <strong>Header </strong><br>文件类型、目标架构类型等<br>2&gt; <strong>Load commands</strong><br>描述文件在虚拟内存中的逻辑结构、布局<br>3&gt; <strong>Raw segment data</strong><br>在Load commands中定义的Segment的原始数据</p>
</li>
</ul>
<p><img src="/2018/11/04/6.Mach-O/Mach-O结构.png" alt="Mach-O结构"></p>
<h2><span id="11窥探mach-o的结构">11.窥探Mach-O的结构</span></h2><p><strong>命令行工具：</strong></p>
<ul>
<li>file：查看Mach-O的文件类型<br><strong>file  文件路径</strong></li>
<li>otool：查看Mach-O特定部分和段的内容</li>
<li>lipo：常用于多架构Mach-O文件的处理<br>1&gt; 查看架构信息：<strong>lipo  -info  文件路径</strong><br>2&gt; 导出某种特定架构：lipo  文件路径  -thin  架构类型  -output  输出文件路径<br>3&gt; 合并多种架构：lipo  文件路径1  文件路径2  -output  输出文件路径</li>
</ul>
<p><strong>GUI工具</strong><br>MachOView: <a href="https://github.com/gdbinit/MachOView" target="_blank" rel="noopener">https://github.com/gdbinit/MachOView </a></p>
<h2><span id="12universal-binary通用二进制文件">12.Universal Binary（通用二进制文件）</span></h2><ul>
<li><p>通用二进制文件<br>1&gt; 同时适用于多种架构的二进制文件<br>2&gt; 包含了多种不同架构的独立的二进制文件</p>
</li>
<li><p>因为需要储存多种架构的代码，通用二进制文件通常比单一平台二进制的程序要大</p>
</li>
<li><p>由于两种架构有共同的一些资源，所以并不会达到单一版本的两倍之多</p>
</li>
<li><p>由于执行过程中，只调用一部分代码，运行起来也不需要额外的内存</p>
</li>
<li><p>因为文件比原来的要大，也被称为“胖二进制文件”（Fat Binary）</p>
</li>
</ul>
<h2><span id="13dyld和mach-o">13.dyld和Mach-O</span></h2><ul>
<li><p>dyld用于加载以下类型的Mach-O文件<br>1&gt; MH_EXECUTE<br>2&gt; MH_DYLIB<br>3&gt; MH_BUNDLE</p>
</li>
<li><p>APP的可执行文件、动态库都是由dyld负责加载的</p>
</li>
</ul>

          
        
      
    </div>

    

    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/11/03/5.Reveal_/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="小马同学">
      <meta itemprop="description" content="iOS小白一枚，写这个博客，首先是为了总结，通过写作来提高自己的写作和表达能力。其次是想把自己理解的东西分享给大家，与大家进行交流，也希望大家可以指出我的不足并提供宝贵的意见！">
      <meta itemprop="image" content="/images/avatar.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="小马同学的技术博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/11/03/5.Reveal_/" itemprop="url">
                  Reveal
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2018-11-03 01:14:00" itemprop="dateCreated datePublished" datetime="2018-11-03T01:14:00+08:00">2018-11-03</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">更新于</span>
                
                <time title="修改时间：2018-11-04 16:00:19" itemprop="dateModified" datetime="2018-11-04T16:00:19+08:00">2018-11-04</time>
              
            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/逆向实战/" itemprop="url" rel="index"><span itemprop="name">逆向实战</span></a></span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>iOS | Reveal | Objective-C</p>
<h2><span id="reveal">Reveal</span></h2><ul>
<li>Reveal是一款调试iOS程序UI界面的神器</li>
<li>官网：<a href="https://revealapp.com" target="_blank" rel="noopener">https://revealapp.com</a></li>
<li>下载：<a href="https://revealapp.com/download/" target="_blank" rel="noopener">https://revealapp.com/download/</a><br>1&gt; <strong>建议下载至少Reveal4版本，支持USB连接调试，速度快。低版本的只能WiFi连接调试</strong></li>
</ul>
<h2><span id="调试环境配置">调试环境配置</span></h2><ul>
<li><p><strong>iPhone上安装Reveal Loader：</strong><br><img src="/2018/11/03/5.Reveal_/Reveal Loader.png" alt="Reveal Loader"></p>
</li>
<li><p><strong>安装完Reveal Loader后，打开【设置】，选择需要调试的APP</strong><br><img src="/2018/11/03/5.Reveal_/选择需要调试的APP.png" alt="选择需要调试的APP"></p>
</li>
<li><p>找到Mac的Reveal中的<strong>RevealServer</strong>文件，覆盖iPhone的<strong>/Library/RHRevealLoader/RevealServer</strong>文件<br><img src="/2018/11/03/5.Reveal_/RevealServer.png" alt="RevealServer"></p>
</li>
<li><p><strong>重启SpringBoard或者重启手机，可以在iPhone上输入终端命令</strong><br>1&gt; 重启SpringBoard：<strong>killall SpringBoard</strong><br>2&gt; 重启手机：<strong>reboot</strong></p>
</li>
</ul>
<h2><span id="选择usb方式">选择USB方式</span></h2><p><img src="/2018/11/03/5.Reveal_/usb.png" alt="usb"></p>
<h2><span id="开始调试">开始调试</span></h2><p><img src="/2018/11/03/5.Reveal_/AppStore.png" alt="AppStore"></p>

          
        
      
    </div>

    

    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/10/29/4.Cycript/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="小马同学">
      <meta itemprop="description" content="iOS小白一枚，写这个博客，首先是为了总结，通过写作来提高自己的写作和表达能力。其次是想把自己理解的东西分享给大家，与大家进行交流，也希望大家可以指出我的不足并提供宝贵的意见！">
      <meta itemprop="image" content="/images/avatar.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="小马同学的技术博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/10/29/4.Cycript/" itemprop="url">
                  Cycript
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2018-10-29 02:05:00" itemprop="dateCreated datePublished" datetime="2018-10-29T02:05:00+08:00">2018-10-29</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">更新于</span>
                
                <time title="修改时间：2018-11-11 15:25:55" itemprop="dateModified" datetime="2018-11-11T15:25:55+08:00">2018-11-11</time>
              
            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/逆向实战/" itemprop="url" rel="index"><span itemprop="name">逆向实战</span></a></span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>iOS | Cycript | Objective-C</p>
<h2><span id="cycript">Cycript</span></h2><ul>
<li>Cycript是Objective-C++、ES6（JavaScript）、Java等语法的混合物</li>
<li>可以用来探索、修改、调试正在运行的Mac\iOS APP</li>
<li>官网：<a href="http://www.cycript.org/" target="_blank" rel="noopener">http://www.cycript.org/</a></li>
<li>文档：<a href="http://www.cycript.org/manual/" target="_blank" rel="noopener">http://www.cycript.org/manual/</a></li>
<li>通过Cydia安装Cycript，即可在iPhone上调试运行中的APP<br><img src="/2018/10/29/4.Cycript/Cycript.png" alt="Cycript"></li>
</ul>
<h2><span id="cycript-的开启和关闭">Cycript 的开启和关闭</span></h2><ul>
<li><strong>开启</strong><br>1&gt; cycript<br>2&gt; cycript -p 进程ID<br>3&gt; cycript -p 进程名称<br><img src="/2018/10/29/4.Cycript/Cycript_open_close.png" alt="Cycript_open_close"></li>
<li><strong>取消输入：Ctrl + C</strong></li>
<li><strong>退出：Ctrl + D</strong></li>
<li><strong>清屏：Command + R</strong></li>
</ul>
<h2><span id="ps命令">ps命令</span></h2><ul>
<li>安装adv-cmds<br><img src="/2018/10/29/4.Cycript/ps.png" alt="ps"></li>
<li>ps命令是process status的缩写，使用ps命令可以列出系统当前的进程<br>1&gt; 列出所有的进程<br><strong>ps –A</strong><br><strong>ps aux</strong><br>2&gt; 搜索关键词<br><strong>ps –A | grep 关键词</strong></li>
</ul>
<h2><span id="常用语法">常用语法</span></h2><ul>
<li><strong>UIApp</strong><br>[UIApplication sharedApplication]</li>
<li><strong>定义变量</strong><br>var 变量名 = 变量值</li>
<li><strong>用内存地址获取对象</strong><br>#内存地址</li>
<li><strong>ObjectiveC.classes</strong><br>已加载的所有OC类</li>
<li><strong>查看对象的所有成员变量</strong><br>*对象<br><img src="/2018/10/29/4.Cycript/常用语法.png" alt="常用语法"></li>
</ul>
<hr>
<ul>
<li><strong>递归打印view的所有子控件（跟LLDB一样的函数）</strong><br>view.recursiveDescription().toString()</li>
<li>筛选出某种类型的对象<br>choose(UIViewController)<br>choose(UITableViewCell)</li>
</ul>
<h2><span id="封装cycript-cy文件编写">封装Cycript - .cy文件编写</span></h2><ul>
<li>我们可以将常用的Cycript代码封装在一个.cy文件中</li>
<li>exports参数名固定，用于向外提供接口<br><img src="/2018/10/29/4.Cycript/封装Cycript.png" alt="cy文件编写"></li>
</ul>
<hr>
<p><strong>封装Cycript - 存放和使用.cy文件：</strong><br>1&gt; 将.cy文件存放到/usr/lib/cycript0.9目录下<br>2&gt; 在Cycript中引用.cy文件，并使用它提供的接口<br><img src="/2018/10/29/4.Cycript/cy文件存放.png" alt="cy文件存放、使用"></p>

          
        
      
    </div>

    

    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/10/23/3.SSH/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="小马同学">
      <meta itemprop="description" content="iOS小白一枚，写这个博客，首先是为了总结，通过写作来提高自己的写作和表达能力。其次是想把自己理解的东西分享给大家，与大家进行交流，也希望大家可以指出我的不足并提供宝贵的意见！">
      <meta itemprop="image" content="/images/avatar.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="小马同学的技术博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/10/23/3.SSH/" itemprop="url">
                  SSH(下)
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2018-10-23 22:05:00" itemprop="dateCreated datePublished" datetime="2018-10-23T22:05:00+08:00">2018-10-23</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">更新于</span>
                
                <time title="修改时间：2018-10-28 02:11:24" itemprop="dateModified" datetime="2018-10-28T02:11:24+08:00">2018-10-28</time>
              
            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/逆向实战/" itemprop="url" rel="index"><span itemprop="name">逆向实战</span></a></span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>iOS | SSH | Objective-C</p>
<h2><span id="1通过usb进行ssh登录">1.通过USB进行SSH登录</span></h2><ul>
<li><p><strong>默认情况下，由于SSH走的是TCP协议，Mac是通过网络连接的方式SSH登录到iPhone，要求iPhone连接WiFi</strong><br><img src="/2018/10/23/3.SSH/SSH_Default.png" alt="SSH_Default"></p>
</li>
<li><p><strong>为了加快传输速度，也可以通过USB连接的方式进行SSH登录</strong><br>1&gt; Mac上有个服务程序usbmuxd（它会开机自动启动），可以将Mac的数据通过USB传输到iPhone：<br>/System/Library/PrivateFrameworks/MobileDevice.framework/Resources/usbmuxd<br><img src="/2018/10/23/3.SSH/SSH_USB.png" alt="SSH_USB"></p>
</li>
</ul>
<h2><span id="2usbmuxd的使用">2.usbmuxd的使用</span></h2><ul>
<li>下载usbmuxd工具包（下载v1.0.8版本，主要用到里面的一个python脚本：<strong>tcprelay.py</strong>）<br><a href="https://cgit.sukimashita.com/usbmuxd.git/snapshot/usbmuxd-1.0.8.tar.gz" target="_blank" rel="noopener">https://cgit.sukimashita.com/usbmuxd.git/snapshot/usbmuxd-1.0.8.tar.gz</a><br>如果下载失败，可尝试点此下载：<a href="/download/SSH/usbmuxd-1.0.8.tar.gz">usbmuxd-1.0.8.tar.gz</a></li>
<li><strong>将iPhone的22端口（SSH端口）映射到Mac本地的10010端口</strong><br>1&gt; <strong>cd ~/Documents/usbmuxd-1.0.8/python-client</strong><br>2&gt; <strong>python tcprelay.py -t 22:10010</strong><br>加上-t参数是为了能够同时支持多个SSH连接<br><img src="/2018/10/23/3.SSH/tcprelay_01.png" alt="tcprelay"></li>
<li><strong>注意：要想保持端口映射状态，不能终止此命令行（如果要执行其他终端命令行，请新开一个终端界面）</strong></li>
<li>不一定非要10010端口，只要不是保留端口就行</li>
</ul>
<hr>
<ul>
<li><strong>端口映射完毕后，以后如果想跟iPhone的22端口通信，直接跟Mac本地的10010端口通信就可以了</strong></li>
<li>新开一个终端界面，SSH登录到Mac本地的10010端口（以下方式2选1）<br>1&gt; <strong>ssh root@localhost -p 10010</strong><br>2&gt; <strong>ssh <a href="mailto:root@192.168.31.26" target="_blank" rel="noopener">root@192.168.31.26</a> -p 10010</strong><br>注：(1) localhost是一个域名，指向的IP地址是192.168.31.26，本机虚拟网卡的IP地址<br>(2) usbmuxd会将Mac本地10010端口的TCP协议数据，通过USB连接转发到iPhone的22端口</li>
<li><strong>远程拷贝文件也可以直接跟Mac本地的10010端口通信</strong><br>1&gt; <strong>scp -P 10010 ~/Desktop/test.txt root@localhost:~/test</strong><br>2&gt; 将Mac上的<strong>~/Desktop/test.txt</strong>文件，拷贝到iPhone上的<strong>~/test</strong>路径<br><strong>注意：</strong>scp的端口号参数是大写的-P</li>
</ul>
<h2><span id="3sh脚本文件">3.sh脚本文件</span></h2><ul>
<li><strong>我们可以将经常执行的一系列终端命令行(比如：刚才提到的端口映射、ssh登录)放到sh脚本文件中（shell），然后执行脚本文件</strong><br><img src="/2018/10/23/3.SSH/testCD_sh.png" alt="testCD_sh"></li>
<li>可以通过sh、bash、source命令来执行sh脚本文件<br><strong>sh、bash:</strong><br>1&gt; 当前shell环境会启动一个子进程来执行脚本文件，执行后返回到父进程的shell环境<br>2&gt; 执行cd时，在子进程中会进入到cd的目录，但是在父进程中环境并没有改变，也就是说目录没有改变<br><strong>source:</strong><br>1&gt; 在当前的shell环境下执行脚本文件<br>2&gt; 执行cd后会跳转到cd的目录<br><img src="/2018/10/23/3.SSH/sh_bash_source.png" alt="sh_bash_source"></li>
</ul>
<h2><span id="4ios终端的中文乱码问题">4.iOS终端的中文乱码问题</span></h2><ul>
<li>默认情况下，iOS终端不支持中文输入和显示</li>
<li>解决方案：新建一个<strong>~/.inputrc</strong>文件，文件内容是<br>1&gt; 不将中文字符转化为转义序列 :<br><strong>set convert-meta off</strong><br>2&gt; 允许向终端输出中文:<br><strong>set output-meta on</strong><br>3&gt; 允许向终端输入中文:<br><strong>set meta-flag on</strong><br><strong>set input-meta on</strong></li>
<li>如果是想在终端编辑文件内容，可以通过Cydia安装一个vim（软件源<a href="http://apt.saurik.com）" target="_blank" rel="noopener">http://apt.saurik.com）</a><br><img src="/2018/10/23/3.SSH/VI IMproved.png" alt="VI IMproved"></li>
</ul>

          
        
      
    </div>

    

    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/10/17/2.SSH/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="小马同学">
      <meta itemprop="description" content="iOS小白一枚，写这个博客，首先是为了总结，通过写作来提高自己的写作和表达能力。其次是想把自己理解的东西分享给大家，与大家进行交流，也希望大家可以指出我的不足并提供宝贵的意见！">
      <meta itemprop="image" content="/images/avatar.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="小马同学的技术博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/10/17/2.SSH/" itemprop="url">
                  SSH(上)
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2018-10-17 22:05:00" itemprop="dateCreated datePublished" datetime="2018-10-17T22:05:00+08:00">2018-10-17</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">更新于</span>
                
                <time title="修改时间：2018-10-27 23:26:43" itemprop="dateModified" datetime="2018-10-27T23:26:43+08:00">2018-10-27</time>
              
            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/逆向实战/" itemprop="url" rel="index"><span itemprop="name">逆向实战</span></a></span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>iOS | SSH | Objective-C</p>
<h2><span id="1mac远程登录到iphone">1.Mac远程登录到iPhone</span></h2><ul>
<li><strong>我们经常在Mac的终端上，通过敲一些命令行来完成一些操作</strong><br><img src="/2018/10/17/2.SSH/terminal.png" alt="terminal"></li>
<li><strong>iOS和Mac OS X都是基于Darwin（苹果的一个基于Unix的开源系统内核），所以iOS中同样支持终端的命令行操作</strong><br>1&gt; 在逆向工程中，我们经常会通过命令行来操纵iPhone</li>
<li><strong>为了能够让Mac终端中的命令行能作用在iPhone上，我们得让Mac和iPhone建立连接</strong><br>1&gt; 通过Mac远程登录到iPhone的方式建立连接<br><img src="/2018/10/17/2.SSH/Mac与iPhone连接.png" alt="Mac与iPhone连接"></li>
</ul>
<h2><span id="2ssh-openssh">2.SSH、OpenSSH</span></h2><p><strong>SSH：</strong><br>1&gt; Secure Shell的缩写，意为“安全外壳协议”，是一种可以为远程登录提供安全保障的协议<br>2&gt; 使用SSH，可以把所有传输的数据进行加密，“中间人”攻击方式就不可能实现，能防止DNS欺骗和IP欺骗<br><img src="/2018/10/17/2.SSH/SSH.png" alt="SSH"></p>
<hr>
<p><strong>OpenSSH：</strong><br>1&gt; 是SSH协议的免费开源实现<br>2&gt; 可以通过OpenSSH的方式让Mac远程登录到iPhone</p>
<hr>
<p><strong>使用OpenSSH远程登录：</strong></p>
<ul>
<li>在iPhone上通过Cydia安装OpenSSH工具（软件源<a href="http://apt.saurik.com）" target="_blank" rel="noopener">http://apt.saurik.com）</a><br><img src="/2018/10/17/2.SSH/OpenSSH-Cydia.png" alt="OpenSSH-Cydia"></li>
<li>OpenSSH的具体使用步骤可以查看Description中的描述<br><img src="/2018/10/17/2.SSH/OpenSSH-Description.png" alt="OpenSSH-Description"></li>
</ul>
<p><strong>使用OpenSSH远程登录 - 使用步骤:</strong></p>
<ul>
<li><strong>SSH是通过TCP协议通信，所以要确保Mac和iPhone在同一局域网下，比如连接着同一个WiFi</strong><br>1&gt; 在Mac的终端输入ssh 账户名@服务器主机地址<br>2&gt; 比如ssh <a href="mailto:root@192.168.31.26" target="_blank" rel="noopener">root@192.168.31.26</a>（这里的服务器是手机）<br>3&gt; 初始密码<strong>alpine</strong></li>
<li><strong>登录成功后就可以使用终端命令行操作iPhone</strong></li>
<li><strong>退出登录命令是exit</strong></li>
</ul>
<hr>
<p><strong>SSH的版本：</strong></p>
<ul>
<li><strong>SSH协议一共2个版本</strong><br>1&gt; SSH-1<br>2&gt; SSH-2</li>
<li><strong>现在用的比较多的是SSH-2，客户端和服务端版本要保持一致才能通信</strong></li>
<li><strong>查看SSH版本（查看配置文件的Protocol字段）</strong><br>1&gt; 客户端：/etc/ssh/ssh_config<br>2&gt; 服务端：/etc/ssh/sshd_config</li>
</ul>
<h2><span id="3root-mobile">3.root、mobile</span></h2><ul>
<li><strong>iOS下有2个常用账户：root、mobile</strong><br>1&gt; root：最高权限账户，$HOME是<strong>/var/root</strong><br>2&gt; mobile：普通权限账户，只能操作一些普通文件，不能操作系统级别的文件，$HOME是/var/mobile</li>
<li><strong>登录mobile用户：root mobile@服务器主机地址</strong></li>
<li><strong>root和mobile用户的初始登录密码都是alpine</strong><br><img src="/2018/10/17/2.SSH/iPhone-account.png" alt="iPhone-account"></li>
<li><strong>最好修改一下root和mobile用户的登录密码（登录root账户后，分别通过passwd、passwd mobile完成）</strong><br><img src="/2018/10/17/2.SSH/iPhone-account-password.png" alt="iPhone-account-password"></li>
</ul>
<h2><span id="4ssl-openssl">4.SSL、OpenSSL</span></h2><p><strong>很多人会将SSH、OpenSSH、SSL、OpenSSL搞混</strong></p>
<ul>
<li><strong>SSL</strong><br>1&gt; Secure Sockets Layer的缩写，是为网络通信提供安全及数据完整性的一种安全协议，在传输层对网络连接进行加密</li>
<li><strong>OpenSSL</strong><br>1&gt; SSL的开源实现<br>2&gt; 绝大部分HTTPS请求等价于：HTTP + OpenSSL</li>
<li><strong>OpenSSH的加密就是通过OpenSSL完成的</strong><br><img src="/2018/10/17/2.SSH/SSL、OpenSSL.png" alt="SSL、OpenSSL"></li>
</ul>
<h2><span id="5ssh的通信过程">5.SSH的通信过程</span></h2><p><strong>SSH的通信过程可以分为3大主要阶段：</strong><br>1&gt; 建立安全连接<br>2&gt; 客户端认证<br>3&gt; 数据传输</p>
<h2><span id="6建立安全连接">6.建立安全连接</span></h2><ul>
<li><strong>在建立安全连接过程中，服务器会提供自己的身份证明</strong><br><img src="/2018/10/17/2.SSH/建立安全连接.png" alt="建立安全连接"></li>
<li><strong>如果客户端并无服务器端的公钥信息，就会询问是否连接此服务器</strong><br><img src="/2018/10/17/2.SSH/SSH-Login.png" alt="SSH-Login"></li>
</ul>
<hr>
<p><strong>服务器身份信息变更：</strong></p>
<ul>
<li><strong>在建立安全连接过程中，可能会遇到以下错误信息：提醒服务器的身份信息发生了变更</strong><br><img src="/2018/10/17/2.SSH/服务器身份信息变更.png" alt="服务器身份信息变更"></li>
<li><strong>如果确定要连接此服务器，删除掉之前服务器的公钥信息就行</strong><br>1&gt; <strong>ssh-keygen -R 服务器IP地址</strong></li>
<li><strong>或者直接打开known_hosts文件删除服务器的公钥信息就行</strong><br>1&gt; <strong>vim ~/.ssh/known_hosts</strong></li>
</ul>
<h2><span id="7ssh的客户端认证方式">7.SSH的客户端认证方式</span></h2><ul>
<li><strong>SSH-2提供了2种常用的客户端认证方式</strong><br>1&gt; 基于密码的客户端认证<br>a.使用账号和密码即可认证<br>2&gt; 基于密钥的客户端认证<br>a.免密码认证<br>b.最安全的一种认证方式</li>
<li><strong>SSH-2默认会优先尝试“密钥认证”，如果认证失败，才会尝试“密码认证”</strong></li>
</ul>
<h2><span id="8ssh-基于密钥的客户端认证">8.SSH - 基于密钥的客户端认证</span></h2><p><img src="/2018/10/17/2.SSH/SSH-秘钥认证.png" alt="SSH-秘钥认证"></p>
<hr>
<ul>
<li>在客户端生成一对相关联的密钥（Key Pair）：一个公钥（Public Key），一个私钥（Private Key）<br>1&gt; <strong>ssh-keygen</strong><br>2&gt; 一路敲回车键（Enter）即可<br>3&gt; OpenSSH默认生成的是RSA密钥，可以通过-t参数指定密钥类型<br>4&gt; 生成的公钥：<strong>~/.ssh/id_rsa.pub</strong><br>5&gt; 生成的私钥：<strong>~/.ssh/id_rsa</strong></li>
<li>把客户端的公钥内容追加到服务器的授权文件（<strong>~/.ssh/authorized_keys</strong>）尾部<br>1&gt; ssh-copy-id root@服务器主机地址<br>2&gt; 需要输入root用户的登录密码<br>3&gt; <strong>ssh-copy-id</strong>会将客户端<strong>~/.ssh/id_rsa.pub</strong>的内容自动追加到服务器的<strong>~/.ssh/authorized_keys</strong>尾部</li>
<li>注意：由于是在~文件夹下操作，所以上述操作仅仅是解决了root用户的登录问题（不会影响mobile用户）</li>
</ul>
<hr>
<p><strong>可以使用ssh-copy-id将客户端的公钥内容自动追加到服务器的授权文件尾部，也可以手动操作：</strong></p>
<ul>
<li><strong>复制客户端的公钥到服务器某路径</strong><br>1&gt; <strong>scp ~/.ssh/id_rsa.pub root@服务器主机地址:~</strong><br>2&gt; scp是secure copy的缩写，是基于SSH登录进行安全的远程文件拷贝命令，把一个文件copy到远程另外一台主机上<br>3&gt; 上面的命令行将客户端的<strong>~/.ssh/id_rsa.pub</strong>拷贝到了服务器的~地址</li>
<li><strong>SSH登录服务器</strong><br>1&gt; <strong>ssh root@服务器主机地址</strong><br>2&gt; 需要输入root用户的登录密码</li>
<li><strong>在服务器创建.ssh文件夹</strong><br>1&gt; <strong>mkdir .ssh</strong></li>
<li><strong>追加公钥内容到授权文件尾部</strong><br>1&gt; <strong>cat ~/id_rsa.pub &gt;&gt; ~/.ssh/authorized_keys</strong></li>
<li><strong>删除公钥</strong><br>1&gt; <strong>rm ~/id_rsa.pub</strong></li>
</ul>
<hr>
<p><strong>文件权限问题:</strong><br><strong>如果配置了免密码登录后，还是需要输入密码，需要在服务器端设置文件权限</strong><br>1&gt; chmod 755 ~<br>2&gt; chmod 755 ~/.ssh<br>3&gt; chmod 644 ~/.ssh/authorized_keys</p>
<h2><span id="922端口">9.22端口</span></h2><ul>
<li><strong>端口就是设备对外提供服务的窗口，每个端口都有个端口号（范围是0~65535，共2^16个）</strong></li>
<li><strong>有些端口号是保留的，已经规定了用途，比如</strong><br>1&gt; 21端口提供FTP服务<br>2&gt; 80端口提供HTTP服务<br>3&gt; 22端口提供SSH服务（可以查看/etc/ssh/sshd_config的Port字段）<br>4&gt; 更多保留端口号:<a href="https://baike.baidu.com/item/%E7%AB%AF%E5%8F%A3%E5%8F%B7/10883658#4_3" target="_blank" rel="noopener">https://baike.baidu.com/item/%E7%AB%AF%E5%8F%A3%E5%8F%B7/10883658#4_3</a></li>
<li><strong>iPhone默认是使用22端口进行SSH通信，采用的是TCP协议</strong><br><img src="/2018/10/17/2.SSH/22端口.png" alt="22端口"></li>
</ul>

          
        
      
    </div>

    

    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/10/09/1.越狱环境搭建/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="小马同学">
      <meta itemprop="description" content="iOS小白一枚，写这个博客，首先是为了总结，通过写作来提高自己的写作和表达能力。其次是想把自己理解的东西分享给大家，与大家进行交流，也希望大家可以指出我的不足并提供宝贵的意见！">
      <meta itemprop="image" content="/images/avatar.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="小马同学的技术博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/10/09/1.越狱环境搭建/" itemprop="url">
                  越狱环境搭建
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2018-10-09 08:00:00" itemprop="dateCreated datePublished" datetime="2018-10-09T08:00:00+08:00">2018-10-09</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">更新于</span>
                
                <time title="修改时间：2018-10-21 22:06:01" itemprop="dateModified" datetime="2018-10-21T22:06:01+08:00">2018-10-21</time>
              
            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/逆向实战/" itemprop="url" rel="index"><span itemprop="name">逆向实战</span></a></span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>iOS | 越狱环境搭建 | Objective-C</p>
<h2><span id="1准备">1.准备</span></h2><ul>
<li><p>调试设备：<br>1&gt; 建议至少iPhone5s（因为从5s开始支持arm64架构）<br>2&gt; 或者至少是iPad Air、iPad mini2等支持arm64架构的设备</p>
</li>
<li><p>系统版本：<br>1&gt; 版本不能太高，最好保证能够完美越狱<br>2&gt; <a href="http://jailbreak.25pp.com/ios" target="_blank" rel="noopener">戳这里查看手机是否可以越狱</a><br>选择系统版本 -&gt;  选择设备 -&gt; 查看是否支持越狱（最好支持完美越狱）</p>
</li>
</ul>
<h2><span id="2ios-jailbreakios越狱">2.iOS Jailbreak（iOS越狱）</span></h2><p>利用iOS系统的漏洞，获取iOS系统的最高权限（Root），解开之前的各种限制（合法行为）</p>
<p><strong>优点：</strong></p>
<ul>
<li><p><strong>打造个性化、与众不同的iPhone</strong><br>1&gt; 自由安装各种实用的插件、主题、APP<br>2&gt; 修改系统APP的一些默认行为</p>
</li>
<li><p><strong>自由安装非AppSore来源的APP</strong><br>1&gt; “付费APP”秒变“免费APP”<br>2&gt; 未越狱iPhone安装APP的途径: AppStore、真机调试、通过证书打包签名ipa安装</p>
</li>
<li><p><strong>灵活管理文件系统，让iPhone可以像U盘那样灵活</strong></p>
</li>
<li><strong>给开发者提供了逆向工程的环境</strong></li>
</ul>
<p><strong>缺点：</strong> </p>
<ul>
<li><strong>不予保修</strong></li>
<li><strong>费电，越狱后的iOS系统会常驻一些进程，耗电速度约提升10%~20%</strong></li>
<li><strong>在新的iOS固件版本出来的时候，不能及时地进行更新</strong><br>1&gt; 每个新版本的固件，都会修复上一个版本的越狱漏洞，使越狱失效<br>2&gt; 如果需要保持越狱状态，要等待新的越狱程序发布时，才能升级相应的固件版本</li>
<li><strong>不再受iOS系统默认的安全保护，容易被恶意软件攻击，个人隐私有被窃取的风险</strong></li>
<li><strong>如果安装了不稳定的插件，容易让系统变得不稳定、变慢，甚至出现“白苹果”等问题</strong></li>
</ul>
<hr>
<p><strong>完美越狱：</strong></p>
<ul>
<li>越狱后的iPhone可以正常关机和重启</li>
</ul>
<p><strong>不完美越狱：</strong></p>
<ul>
<li>iPhone一旦关机后再开机时，屏幕就会一直停留在启动画面，也就是“白苹果”状态</li>
<li>或者能正常开机，但已经安装的破解软件都无法正常使用，需要将设备与PC连接后，使用软件进行引导才能使用</li>
<li>一般说来，在苹果发布新的iOS固件后，针对该固件的不完美越狱会先发布，随后完美越狱才可能发布</li>
<li>一般较新的系统版本，均为不完美越狱</li>
</ul>
<p><strong>越狱方法推荐：</strong><br><strong>PP助手：</strong><a href="http://jailbreak.25pp.com/" target="_blank" rel="noopener">http://jailbreak.25pp.com/</a></p>
<p><strong>如何判断是否越狱成功？</strong></p>
<ul>
<li><strong>桌面是否有Cydia</strong><br><img src="/2018/10/09/1.越狱环境搭建/Cydia.png" alt="桌面是否有Cydia"></li>
<li><strong>工具判断（eg. PP助手）</strong><br><img src="/2018/10/09/1.越狱环境搭建/PP助手-设备信息.png" alt="工具判断（比如PP助手）"></li>
</ul>
<h2><span id="3cydia">3.Cydia</span></h2><p><strong>1&gt; 越狱后的“App Store”</strong><br>可以在Cydia中安装各种第三方的软件（插件、补丁、APP）</p>
<p><strong>2&gt; 作者</strong><br>Jay Freeman (saurik)<br><img src="/2018/10/09/1.越狱环境搭建/Jay Freeman-saurik.png" alt="Cydia"></p>
<p><strong>Cydia安装软件的步骤:</strong><br><strong>1&gt;添加软件源（不同软件的软件源可能不同）</strong><br><img src="/2018/10/09/1.越狱环境搭建/添加软件源.png" alt="添加软件源"><br><strong>2&gt;进入软件源找到对应的软件，开始安装</strong><br><img src="/2018/10/09/1.越狱环境搭建/安装软件.png" alt="安装软件"></p>
<p><strong>SpringBoard</strong></p>
<ul>
<li>SpringBoard就是iOS的桌面</li>
<li>有时候通过Cydia安装完插件后，可能会出现以下界面<br><img src="/2018/10/09/1.越狱环境搭建/重启SpringBoard.png" alt="重启SpringBoard"></li>
</ul>
<h2><span id="4必备软件安装">4.必备软件安装</span></h2><p><strong>Apple File Conduit “2”</strong></p>
<ul>
<li><strong>Apple File Conduit “2”补丁的作用：</strong><br>1&gt; 可以访问整个iOS设备的文件系统<br>2&gt; 类似的补丁还有：afc2、afc2add</li>
<li><strong>软件源：</strong><br>1&gt; <a href="http://apt.saurik.com" target="_blank" rel="noopener">http://apt.saurik.com</a><br>2&gt; <a href="http://apt.25pp.com" target="_blank" rel="noopener">http://apt.25pp.com</a><br><img src="/2018/10/09/1.越狱环境搭建/Apple File Conduit &quot;2&quot;.png" alt="Apple File Conduit &quot;2&quot;"></li>
</ul>
<hr>
<p><strong>AppSync Unified</strong></p>
<ul>
<li><strong>AppSync Unified补丁的作用：</strong><br>1&gt; 可以绕过系统验证，随意安装、运行破解的ipa安装包</li>
<li><strong>软件源：</strong><br>1&gt; <a href="http://apt.25pp.com" target="_blank" rel="noopener">http://apt.25pp.com</a><br><img src="/2018/10/09/1.越狱环境搭建/AppSync Unified.png" alt="AppSync Unified"></li>
</ul>
<hr>
<p><strong>iFile</strong></p>
<ul>
<li><strong>iFile的作用：</strong><br>1&gt; 可以在iPhone上自由访问iOS文件系统<br>2&gt; 类似的还有Filza File Manager、File Browser</li>
<li><strong>软件源：</strong><br>1&gt; <a href="http://apt.thebigboss.org/repofiles/cydia" target="_blank" rel="noopener">http://apt.thebigboss.org/repofiles/cydia</a><br><img src="/2018/10/09/1.越狱环境搭建/iFile.png" alt="iFile"></li>
</ul>
<hr>
<p><strong>PP助手</strong></p>
<ul>
<li><strong>PP助手的作用：</strong><br>1&gt; 可以利用PP助手自由安装海量APP</li>
<li><strong>软件源：</strong><br>1&gt; <a href="http://apt.25pp.com/" target="_blank" rel="noopener">http://apt.25pp.com/</a><br><img src="/2018/10/09/1.越狱环境搭建/PP助手.png" alt="iFile"></li>
</ul>
<hr>
<p><strong>Mac必备：</strong></p>
<ul>
<li><p><strong>iFunBox</strong><br>1&gt; 管理文件系统</p>
</li>
<li><p><strong>PP助手</strong><br>1&gt; 自由安装海量APP<br>2&gt; 卸载APP<br>3&gt; 备份APP为ipa安装包（iOS9开始，不再支持备份APP）</p>
</li>
</ul>
<hr>
<p><strong>建议安装顺序：</strong><br><img src="/2018/10/09/1.越狱环境搭建/建议安装顺序.png" alt="建议安装顺序"></p>
<hr>
<p><strong>安装包</strong></p>
<ul>
<li><strong>通常情况下</strong><br>1&gt; 通过Cydia安装的安装包是deb格式的（结合软件包管理工具apt）<br>2&gt; 通过PP助手安装的安装包是ipa格式的</li>
<li><strong>如果通过Cydia源安装deb失败</strong><br>1&gt; 可以先从网上下载deb格式的安装包<br>2&gt; 然后打开 iFunBox -&gt; 文件系统，将deb安装包放到/var/root/Media/Cydia/AutoInstall<br>3&gt; 重启手机，Cydia就会自动安装deb</li>
<li><strong>比如，下图是iFile 2.2.0-1所需的deb安装包</strong><br><a href="/download/1.越狱环境搭建/iFile2.2.0-1.zip">点击下载iFile安装包</a><br><img src="/2018/10/09/1.越狱环境搭建/iFile安装包安装.png" alt="iFile安装包安装"></li>
</ul>
<h2><span id="5如何在ios代码中判断设备是否越狱">5.如何在iOS代码中判断设备是否越狱？</span></h2><p><strong>1&gt; 针对不同iOS版本的判断方法可能不一样</strong><br><strong>2&gt; 最简单的一种方法：判断手机上是否安装了Cydia</strong><br><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[[<span class="built_in">NSFileManager</span> defaultManager] fileExistsAtPath:<span class="string">@"/Applications/Cydia.app"</span>];</span><br></pre></td></tr></table></figure></p>
<p>当然，不同系统版本判断方法可能不太一样，仅用这个方法判断是不严谨的，如果需要更完善的方法的同学们可自行谷歌</p>

          
        
      
    </div>

    

    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/10/03/LLVM-Clang 插件开发/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="小马同学">
      <meta itemprop="description" content="iOS小白一枚，写这个博客，首先是为了总结，通过写作来提高自己的写作和表达能力。其次是想把自己理解的东西分享给大家，与大家进行交流，也希望大家可以指出我的不足并提供宝贵的意见！">
      <meta itemprop="image" content="/images/avatar.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="小马同学的技术博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/10/03/LLVM-Clang 插件开发/" itemprop="url">
                  LLVM-Clang 插件开发
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2018-10-03 13:59:05 / 修改时间：21:13:34" itemprop="dateCreated datePublished" datetime="2018-10-03T13:59:05+08:00">2018-10-03</time>
            

            
              

              
            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/编译原理/" itemprop="url" rel="index"><span itemprop="name">编译原理</span></a></span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>iOS | LLVM | Objective-C</p>
<h1><span id="clang-插件开发-准备">Clang 插件开发-准备</span></h1><p><strong>$ cd LLVM_ALL/llvm/tools/clang/tools</strong><br><strong>$ mkdir Your_Plugin_Dir_Name</strong><br>新建文件夹（自己的插件，eg. 我的文件夹命名为 mz-plugin，后面以我自己的文件目录讲解，各位同学在实践的时候请注意替换为自己的文件夹目录）</p>
<p>在 <strong>clang/tools</strong> 目录下 <strong>CMakeLists.txt</strong> 文件最下方添加我们自己的插件目录: <strong>add_clang_subdirectory(mz-plugin)</strong>，这样，clang 在编译时就会加载我们插件目录下的插件</p>
<p><strong>$ cd mz-plugin</strong><br><strong>$ touch MZPlugin.cpp</strong><br><strong>$ touch CMakeLists.txt</strong></p>
<p>编辑 <strong>CMakeLists.txt</strong>，添加下面这行：<br><strong>add_llvm_loadable_module(MZPlugin MZPlugin.cpp)</strong><br><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 如果有多个 cpp 文件，可以如下：</span></span><br><span class="line">add_llvm_loadable_module(MZPlugin </span><br><span class="line">MZPlugin1.cpp</span><br><span class="line">MZPlugin2.cpp</span><br><span class="line">MZPlugin3.cpp</span><br><span class="line">)</span><br></pre></td></tr></table></figure></p>
<h1><span id="编写插件">编写插件</span></h1><p>编写 C++ 文件，当然是用 IDE 方便了，在 <strong>llvm_xcode</strong> 目录下执行 <strong>cmake -G Xcode ../llvm</strong> 生成的模板工程，首次打开选择 <strong>Automatically Create Schemes</strong> 方式创建scheme<br><img src="/2018/10/03/LLVM-Clang 插件开发/Automatically Create Schemes.png" alt="Automatically Create Schemes"></p>
<p>找到我们自己的插件 cpp 文件 <strong>Loadable modules/MZPlugin/MZPlugin.cpp</strong>，编写插件：<br><img src="/2018/10/03/LLVM-Clang 插件开发/插件cpp文件.png" alt="插件cpp文件"></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#include <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#include <span class="meta-string">"clang/AST/AST.h"</span></span></span><br><span class="line"><span class="meta">#include <span class="meta-string">"clang/AST/ASTConsumer.h"</span></span></span><br><span class="line"><span class="meta">#include <span class="meta-string">"clang/ASTMatchers/ASTMatchers.h"</span></span></span><br><span class="line"><span class="meta">#include <span class="meta-string">"clang/ASTMatchers/ASTMatchFinder.h"</span></span></span><br><span class="line"><span class="meta">#include <span class="meta-string">"clang/Frontend/CompilerInstance.h"</span></span></span><br><span class="line"><span class="meta">#include <span class="meta-string">"clang/Frontend/FrontendPluginRegistry.h"</span></span></span><br><span class="line"></span><br><span class="line">using namespace clang;</span><br><span class="line">using namespace std;</span><br><span class="line">using namespace llvm;</span><br><span class="line"></span><br><span class="line">namespace MZPlugin &#123;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> MZConsumer : public ASTConsumer &#123;</span><br><span class="line">    public:</span><br><span class="line">    <span class="comment">// 重写 HandleTranslationUnit，在每编译完成一个语法树时都会调用此方法</span></span><br><span class="line">    <span class="keyword">void</span> HandleTranslationUnit(ASTContext &amp;Ctx) &#123;</span><br><span class="line">        cout &lt;&lt; <span class="string">"MZPlugin-HandlerTranslationUnit，编译完成一个语法树"</span> &lt;&lt; endl;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 继承 PluginASTAction，重写两个方法</span></span><br><span class="line"><span class="keyword">class</span> MZAction: public PluginASTAction &#123;</span><br><span class="line">    public:</span><br><span class="line">    unique_ptr&lt;ASTConsumer&gt; CreateASTConsumer(CompilerInstance &amp;ci, StringRef isFile) &#123;</span><br><span class="line">        <span class="keyword">return</span> unique_ptr&lt;MZConsumer&gt; (new MZConsumer);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">bool</span> ParseArgs(<span class="keyword">const</span> CompilerInstance &amp;ci, <span class="keyword">const</span> vector&lt;string&gt; &amp;args) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">注册插件</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">1.static clang::FrontendPluginRegistry::Add&lt;MZPlugin::MZAction&gt;</span></span><br><span class="line"><span class="comment">2.泛型 声明 Add 类型，指定 MZPlugin 的 MZAction</span></span><br><span class="line"><span class="comment">3.官方给的示例用的 X 就按官方的来吧</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">@param "MZPlugin" 插件名称</span></span><br><span class="line"><span class="comment">@param clang-plugin." 插件描述</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">static</span> FrontendPluginRegistry::Add&lt;MZPlugin::MZAction&gt;</span><br><span class="line">X(<span class="string">"MZPlugin"</span>, <span class="string">"The MZPlugin is my first clang-plugin."</span>);</span><br></pre></td></tr></table></figure>
<h1><span id="编译插件">编译插件</span></h1><p>编写完成之后，选择我们的插件 <strong>target</strong>，编译出 .dylib 插件文件：<br><img src="/2018/10/03/LLVM-Clang 插件开发/编译插件.png" alt="编译插件"></p>
<p>编译成功之后，会在 <strong>llvm_xcode/Debug/lib/</strong> 目录下生成 <strong>MZPlugin.dylib</strong>文件</p>
<h1><span id="使用插件">使用插件</span></h1><p>在Xcode 项目中指定加载插件动态库：Build Settings -&gt; Other C Flags:<br><strong>-Xclang -load -Xclang 动态库全路径 -Xclang -add-plugin -Xclang 插件名称</strong></p>
<p>eg.-Xclang -load -Xclang /Users/<strong>username</strong>/Desktop/项目/LLVM_ALL<br>/llvm_xcode/Debug/lib/MZPlugin.dylib -Xclang -add-plugin -Xclang MZPlugin</p>
<p><img src="/2018/10/03/LLVM-Clang 插件开发/Other C Flags.png" alt="Other C Flags"></p>
<p>已经安耐不住激动的心情了么，编译项目，结果会报错，因为 Xcode  Build Settings <strong>Compiler for C/C++/Objective</strong> 默认编译器使用的是 <strong>Default compiler（Apple LLVM 9.0）</strong>，不让我们选择我们自己的编译器，我们还需要最后一步，Hack Xcode，然后才能修改默认的编译器</p>
<h1><span id="hack-xcode">Hack Xcode</span></h1><p>下载 <a href="/download/插件开发/XcodeHacking.zip"><strong>XcodeHacking.zip</strong></a>，解压，修改 <strong>HackedClang.xcplugin/Contents/Resources/HackedClang.xcspec</strong>，将 ExecPath 位置 替换为我们刚才用 ninja 编译好的 clang 的全路径<br>eg.  /Users/<strong>username</strong>/Desktop/项目/LLVM_ALL/llvm_release/bin/clang<br><img src="/2018/10/03/LLVM-Clang 插件开发/HackedClang.xcspec.png" alt="HackedClang.xcspec"></p>
<p>然后执行下面两行指令将这两个文件移至 Xcode 包中：<br><strong>$ sudo mv HackedClang.xcplugin <code>xcode-select -print-path</code>/../PlugIns<br>/Xcode3Core.ideplugin/Contents/SharedSupport/Developer/Library/Xcode/Plug-ins</strong></p>
<p><strong>$ sudo mv HackedBuildSystem.xcspec <code>xcode-select -print-path</code>/Platforms<br>/iPhoneSimulator.platform/Developer/Library/Xcode/Specifications</strong></p>
<p>完成之后，重启 Xcode，这时，我们就可以修改 Xcode 默认的编译器了<br><img src="/2018/10/03/LLVM-Clang 插件开发/Compiler.png" alt="Compiler for C/C++/Objective"></p>
<p>选择 <strong>Clang LLVM Trunk</strong>，然后进行编译，这时候我们观察下便以信息，会发现，刚才我们输出我们在 <strong>HandleTranslationUnit</strong> 方法中的信息已经成功输出<br><img src="/2018/10/03/LLVM-Clang 插件开发/success.png" alt="success"></p>
<h2><span id="总结">总结</span></h2><p>至此我们已经完成了一个简单的插件开发，如果需要开发更牛逼的功能，我们还需要对编译原理、语义分析等进行更深入的了解，感兴趣的童鞋可以深入研究</p>

          
        
      
    </div>

    

    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/09/24/编译器王者-LLVM/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="小马同学">
      <meta itemprop="description" content="iOS小白一枚，写这个博客，首先是为了总结，通过写作来提高自己的写作和表达能力。其次是想把自己理解的东西分享给大家，与大家进行交流，也希望大家可以指出我的不足并提供宝贵的意见！">
      <meta itemprop="image" content="/images/avatar.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="小马同学的技术博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/09/24/编译器王者-LLVM/" itemprop="url">
                  编译器王者-LLVM
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2018-09-24 19:22:19" itemprop="dateCreated datePublished" datetime="2018-09-24T19:22:19+08:00">2018-09-24</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">更新于</span>
                
                <time title="修改时间：2018-10-03 17:26:10" itemprop="dateModified" datetime="2018-10-03T17:26:10+08:00">2018-10-03</time>
              
            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/编译原理/" itemprop="url" rel="index"><span itemprop="name">编译原理</span></a></span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>iOS | LLVM | Objective-C</p>
<h1><span id="llvm-是什么">LLVM 是什么？</span></h1><p><img src="/2018/09/24/编译器王者-LLVM/LLVM_Logo.svg" alt="LLVM-logo"></p>
<blockquote>
<p>The LLVM Project is a collection of modular and reusable compiler and toolchain technologies.<br>官网：<a href="https://llvm.org/" target="_blank" rel="noopener">https://llvm.org/</a></p>
</blockquote>
<p>LLVM 项目是模块化、可重用的编译器以及工具链技术的集合，美国计算机协会（ACM）将其2012年软件系统奖项颁给了LLVM，之前曾获得此奖项的软件和技术包括：Java、Apache、Mosaic、the World Wide Web、Smalltalk、UNIX、Eclipse等</p>
<p>创始人： Chris Lattner，亦是Swift之父</p>
<blockquote>
<ul>
<li>有些文章把 LLVM 当做 Low Level Virtual Machine（低级虚拟机）的缩写简称，官方描述如下:</li>
<li>The name “LLVM” itself is not an acronym; it is the full name of the project.<br>“LLVM” 不是首字母缩略词，它是项目的全称</li>
</ul>
</blockquote>
<h1><span id="传统的编译器架构">传统的编译器架构</span></h1><p><img src="/2018/09/24/编译器王者-LLVM/传统编译器架构.png" alt="传统编译器架构"><br>传统编译器架构：</p>
<ul>
<li>Frontend：前端（词法分析、语法分析、语义分析、生成中间代码）</li>
<li>Optimizer：优化器（中间代码优化）</li>
<li>Backend：后端（生成对应平台、设备、架构机器码）</li>
</ul>
<h1><span id="llvm架构">LLVM架构</span></h1><p><img src="/2018/09/24/编译器王者-LLVM/LLVM编译器架构.png" alt="传统编译器架构"><br>不同的前端后端使用统一的中间代码 LLVM Intermediate Representation（LLVM IR）</p>
<p>统一中间代码的优点：<br>1&gt; 如果需要支持一种新的编程语言，只需要实现一个新的前端<br>2&gt; 如果需要支持一种新的硬件设备，只需要实现一个新的后端<br>3&gt; 优化阶段是一个通用的阶段，它针对的是统一的 LLVM IR，不论是支持新的编程语言，还是支持新的硬件设备，都不需要对优化阶段做修改</p>
<p>相比之下，GCC 的前端和后端没有分的太开，前端后端耦合在一起。所以 GCC 为了支持一门新的语言，或者支持一个新的目标平台，就变得非常困难</p>
<p>LLVM 现在被作为实现各种静态和运行时编译语言的通用基础结构（GCC家族、JAVA、.NET、Python、Ruby、Scheme、Haskell等）</p>
<h1><span id="clang">Clang</span></h1><p>1&gt; 什么是 Clang ?<br>Clang 是 LLVM 项目的一个子项目，基于 LLVM 架构 C/C++/Objective-C 的编译器前端</p>
<p>官网：<a href="http://clang.llvm.org/" target="_blank" rel="noopener">http://clang.llvm.org/</a></p>
<p>2&gt; 相比于 GCC，Clang 具有如下有点：<br><strong>编译速度快</strong>：在某些平台上，Clang 的编译速度显著的快过 GCC（Debug 模式下编译 OC 速度比 GCC 快 3 倍）<br><strong>占用内存小</strong>：Clang 生成的 AST(语法树) 所占用的内存是 GCC 的五分之一左右<br><strong>模块化设计</strong>：Clang 采用基于库的模块化设计，易于 IDE 继承及其他用途的作用<br><strong>诊断信息可读性强</strong>：在编译过程中，Clang 创建并保留了大量详细的元数据（metadata），有利于调试和错误定位<br><strong>设计清晰简单</strong>，容易理解，易于扩展增强</p>
<h1><span id="clang-与-llvm">Clang 与 LLVM</span></h1><p><img src="/2018/09/24/编译器王者-LLVM/Clang-LLVM_1.jpg" alt="传统编译器架构"><br><strong>广义的 LLVM</strong>：整个 LLVM 架构<br><strong>狭义的 LLVM</strong>：LLVM 后端（代码优化、目标代码生成等）</p>
<p><img src="/2018/09/24/编译器王者-LLVM/Clang-LLVM_2.png" alt="传统编译器架构"></p>
<h1><span id="oc源文件的编译过程">OC源文件的编译过程</span></h1><p><strong>命令行查看编译的过程</strong>：$ clang -ccc-print-phases main.m<br><img src="/2018/09/24/编译器王者-LLVM/OC源文件编译过程1.png" alt="OC源文件编译器过程1"><br>输入 main.m =&gt; 预处理器，预处理（include、import、宏定义…），输出 cpp 文件 =&gt; compiler 编译成中间代码 ir =&gt; 后端，目标代码 =&gt; 链接动态库等 =&gt; 适合 ** 架构的代码</p>
<p><strong>查看preprocessor（预处理）的结果</strong>：$ clang -E main.m</p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#include <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#define AGE 30</span></span><br><span class="line"><span class="keyword">int</span> main(<span class="keyword">int</span> argc, <span class="keyword">const</span> <span class="keyword">char</span> * argv[]) &#123;</span><br><span class="line">    <span class="keyword">int</span> a = <span class="number">10</span>;</span><br><span class="line">    <span class="keyword">int</span> b = <span class="number">20</span>;</span><br><span class="line">    <span class="keyword">int</span> c = a + b + AGE;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="/2018/09/24/编译器王者-LLVM/OC源文件编译过程1.png" alt="OC源文件编译过程2"><br>执行上面的命令行之后，发现预处理器将 &lt;stdio.h&gt; 中代码引了进来，而且将 AGE 宏 也替换成了 30</p>
<h1><span id="词法分析">词法分析</span></h1><p><strong>词法分析，生成 Token</strong>：$ clang -fmodules -E -Xclang -dump-tokens main.m<br><img src="/2018/09/24/编译器王者-LLVM/词法分析.png" alt="OC源文件编译过程2"><br>将代码中每个部分生成 token，’int’、’main’、’(‘、’int’、’argc’ …，一遍后面分析，Loc=<a href="main.m:13:9" target="_blank" rel="noopener">main.m:13:9</a>表示 main.m 13 行第 9 个字符</p>
<h1><span id="语法树-ast">语法树 - AST</span></h1><p><strong>语法分析，生成语法树（AST，Abstract Syntax Tree）</strong>：$ clang -fmodules -fsyntax-only -Xclang -ast-dump main.m</p>
<p>词法分析之后将 Token 拼接、联系起来，生成语法树：<br><img src="/2018/09/24/编译器王者-LLVM/语法树.png" alt="OC源文件编译过程2"></p>
<h1><span id="llvm-ir">LLVM IR</span></h1><p>LLVM IR 有3中表示形式（但本质是等价的，就好比水可以有气体、液体、固体3中形态）</p>
<p><strong>1&gt;text</strong>：便于阅读的文本格式，类似于汇编语言，扩展名 .ll，$ clang -S -emit-llvm main.m<br><strong>2&gt;memory</strong>：内存格式<br><strong>3&gt;bitcode</strong>：二进制格式，扩展名 .bc，$ clang -c -emit-llvm main.m</p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">void</span> test(<span class="keyword">int</span> a, <span class="keyword">int</span> b) &#123;</span><br><span class="line">    <span class="keyword">int</span> c = a + b - <span class="number">3</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>上面代码生成 text 格式中间代码：<br><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">define <span class="keyword">void</span> @test(i32, i32) <span class="meta">#0 &#123;</span></span><br><span class="line">    <span class="comment">// 定义一个局部变量 int a </span></span><br><span class="line">    %<span class="number">3</span> = alloca i32, align <span class="number">4</span></span><br><span class="line">    <span class="comment">// 定义一个局部变量 int b</span></span><br><span class="line">    %<span class="number">4</span> = alloca i32, align <span class="number">4</span></span><br><span class="line">    <span class="comment">// 定义一个局部变量 int c</span></span><br><span class="line">    %<span class="number">5</span> = alloca i32, align <span class="number">4</span></span><br><span class="line">    <span class="comment">// 将 0（第一个参数）的值赋给 3，即 a</span></span><br><span class="line">    store i32 %<span class="number">0</span>, i32* %<span class="number">3</span>, align <span class="number">4</span></span><br><span class="line">    <span class="comment">// 将 1（第二个参数）的值赋给 4，即 b</span></span><br><span class="line">    store i32 %<span class="number">1</span>, i32* %<span class="number">4</span>, align <span class="number">4</span></span><br><span class="line">    <span class="comment">// 读取 3 的值给 6，即 a</span></span><br><span class="line">    %<span class="number">6</span> = load i32, i32* %<span class="number">3</span>, align <span class="number">4</span></span><br><span class="line">    <span class="comment">// 读取 4 的值给 7，即 b</span></span><br><span class="line">    %<span class="number">7</span> = load i32, i32* %<span class="number">4</span>, align <span class="number">4</span></span><br><span class="line">    <span class="comment">// 6 + 7，即 a + b，给 8</span></span><br><span class="line">    %<span class="number">8</span> = add nsw i32 %<span class="number">6</span>, %<span class="number">7</span></span><br><span class="line">    <span class="comment">// 8 - 3，即 a + b - 3</span></span><br><span class="line">    %<span class="number">9</span> = sub nsw i32 %<span class="number">8</span>, <span class="number">3</span></span><br><span class="line">    <span class="comment">// 将 a + b - 3 的结果给 5，即 c，即 c = a + b - 3</span></span><br><span class="line">    store i32 %<span class="number">9</span>, i32* %<span class="number">5</span>, align <span class="number">4</span></span><br><span class="line">    ret <span class="keyword">void</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p><strong>IR 基本语法:</strong><br>1&gt; 注释以分号<strong> ;</strong> 开头<br>2&gt; 全局标识符以<strong>@</strong>开头，局部标识符以<strong>%</strong>开头<br>3&gt; <strong>alloca</strong>，在当前函数栈帧中分配内存<br>4&gt; <strong>i32</strong>，32bit，4个字节的意思<br>5&gt; <strong>align</strong>，内存对齐<br>6&gt; <strong>store</strong>，写入数据<br>7&gt; <strong>load</strong>，读取数据</p>
<p>官方语法参考：<br><a href="https://llvm.org/docs/LangRef.html" target="_blank" rel="noopener">https://llvm.org/docs/LangRef.html</a></p>
<hr>
<p>上面带大家简单熟悉了下 LLVM，感兴趣的童鞋可以进入官网自行深入研究。光了解是不是有点无趣呢，接下来，我们来开发一个我们自己的编译器插件</p>
<h1><span id="llvm-clang-源码下载">LLVM、Clang 源码下载</span></h1><p>下载LLVM<br>\$ <a href="https://git.llvm.org/git/llvm.git/" target="_blank" rel="noopener">https://git.llvm.org/git/llvm.git/</a><br>大小 661.3 M，仅供参考</p>
<p>下载clang<br>\$ cd llvm/tools<br>$ git clone <a href="https://git.llvm.org/git/clang.git/" target="_blank" rel="noopener">https://git.llvm.org/git/clang.git/</a><br>大小 242.9 M，仅供参考</p>
<h1><span id="源码编译">源码编译</span></h1><p>我们在终端可以敲 clang 命令，是因为在 Xcode …/XcodeDefault.xctoolchain/user/bin目录下已经安装了Clang，并且MAC 默认用的是 Xcode 内置的 Clang。既然我们要开发自己的编译器插件，所以在源码下载完成之后，我们需要编译我们自己的 Clang</p>
<p><strong>安装 cmake 和 ninja</strong>（先安装brew，<a href="https://brew.sh" target="_blank" rel="noopener">https://brew.sh</a>）<br>1&gt; $ brew install cmake<br>2&gt; $ brew install ninja</p>
<p><strong>注</strong>：ninja 如果安装失败，可以直接从 github 获取 release 版放入 <strong>/usr/local/bin</strong>中，<a href="https://github.com/ninja-build/ninja/releases" target="_blank" rel="noopener">https://github.com/ninja-build/ninja/releases</a></p>
<hr>
<p>在LLVM源码统计目录下新建一个 <strong>llvm_build</strong>目录（最终会在 <strong>llvm_build</strong> 目录下生成 <strong>build.ninja</strong>）</p>
<p>/LLVM_ALL/llvm<br>/LLVM_ALL/llvm_build<br>/LLVM_ALL/llvm_release<br>/LLVM_ALL/llvm_xcode</p>
<p><strong>$ cd llvm_build</strong><br><strong>$ cmake -G Ninja ../llvm</strong>(指定 llvm 源码位置，会将 llvm 源码在llvm_build 目录下生成 ninja 的模板，注：llvm 路径需根据自己的 llvm 目录相对于 llvm_build 的位置) <strong>成功的标识</strong>：llvm_build 目录下生成 build.ninja 文件</p>
<p><strong>指定LLVM编译目标路径：</strong><br><strong>$ cmake -G Ninja ../llvm -DCMAKE_INSTALL_PREFIX=LLVM的安装路径</strong><br>(eg.)  $ cmake -G Ninja ../llvm -DCMAKE_INSTALL_PREFIX=/users/<em>username</em>/Desktop/项目/LLVM_ALL/llvm_release/</p>
<p>更多 cmake 相关选项，可以参考：<a href="https://llvm.org/docs/CMake.html" target="_blank" rel="noopener">https://llvm.org/docs/CMake.html</a></p>
<hr>
<p>依次执行编译、安装指令<br><strong>$ ninja</strong><br>编译完毕后， <strong>llvm_build</strong> 目录大概 21.61 G（仅供参考）<br><strong>$ ninja install</strong><br>安装完毕后，安装目录大概 12.21 G（仅供参考）</p>
<hr>
<p>生成 Xcode 模板工程，使用 Xcode 进行编译<br><strong>$ cd llvm_xcode</strong><br><strong>$ cmake -G Xcode ../llvm</strong></p>
<h1><span id="应用与实践">应用与实践</span></h1><p>1&gt; libclang、libTooling<br>官方参考：<a href="https://clang.llvm.org/docs/Tooling.html" target="_blank" rel="noopener">https://clang.llvm.org/docs/Tooling.html</a><br>应用：<strong>语法树分析</strong>、<strong>语言转换</strong>等</p>
<p>2&gt; Clang 插件开发<br>官方参考：<br><a href="https://clang.llvm.org/docs/" target="_blank" rel="noopener">https://clang.llvm.org/docs/</a><br><a href="https://clang.llvm.org/docs/ClangPlugins.html" target="_blank" rel="noopener">https://clang.llvm.org/docs/ClangPlugins.html</a><br><a href="https://clang.llvm.org/docs/ExternalClangExamples.html" target="_blank" rel="noopener">https://clang.llvm.org/docs/ExternalClangExamples.html</a><br><a href="https://clang.llvm.org/docs/RAVFrontendAction.html" target="_blank" rel="noopener">https://clang.llvm.org/docs/RAVFrontendAction.html</a><br>应用：<strong>代码检查（命名规范、代码规范）</strong>等</p>
<p>3&gt; Pass开发<br>官方参考：<a href="http://llvm.org/docs/WritingAnLLVMPass.html" target="_blank" rel="noopener">http://llvm.org/docs/WritingAnLLVMPass.html</a><br>应用：<strong>代码优化</strong>、<strong>代码混淆</strong>等</p>
<p>4&gt; 开发新的编程语言<br><a href="https://llvm-tutorial-cn.readthedocs.io/en/latest/" target="_blank" rel="noopener">https://llvm-tutorial-cn.readthedocs.io/en/latest/index.html</a><br><a href="https://kaleidoscope-llvm-tutorial-zh-cn.readthedocs.io/zh_CN/latest/" target="_blank" rel="noopener">https://kaleidoscope-llvm-tutorial-zh-cn.readthedocs.io/zh_CN/latest</a></p>

          
        
      
    </div>

    

    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  
  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="extend next" rel="next" href="/page/2/"><i class="fa fa-angle-right" aria-label="下一页"></i></a>
  </nav>



          </div>
          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image"
                src="/images/avatar.png"
                alt="小马同学" />
            
              <p class="site-author-name" itemprop="name">小马同学</p>
              <p class="site-description motion-element" itemprop="description">iOS小白一枚，写这个博客，首先是为了总结，通过写作来提高自己的写作和表达能力。其次是想把自己理解的东西分享给大家，与大家进行交流，也希望大家可以指出我的不足并提供宝贵的意见！</p>
          </div>

          
            <nav class="site-state motion-element">
              
                <div class="site-state-item site-state-posts">
                
                  <a href="/archives/">
                
                    <span class="site-state-item-count">18</span>
                    <span class="site-state-item-name">日志</span>
                  </a>
                </div>
              

              
                
                
                <div class="site-state-item site-state-categories">
                  <a href="/categories/index.html">
                    
                    
                      
                    
                      
                    
                      
                    
                      
                    
                    <span class="site-state-item-count">4</span>
                    <span class="site-state-item-name">分类</span>
                  </a>
                </div>
              

              
                
                
                <div class="site-state-item site-state-tags">
                  <a href="/tags/index.html">
                    
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                    <span class="site-state-item-count">14</span>
                    <span class="site-state-item-name">标签</span>
                  </a>
                </div>
              
            </nav>
          

          

          
            <div class="links-of-author motion-element">
              
                <span class="links-of-author-item">
                  <a href="https://github.com/iStonesy" target="_blank" title="GitHub"><i class="fa fa-fw fa-github"></i>GitHub</a>
                  
                </span>
              
                <span class="links-of-author-item">
                  <a href="mailto:zzumalei@163.coem" target="_blank" title="E-Mail"><i class="fa fa-fw fa-envelope"></i>E-Mail</a>
                  
                </span>
              
                <span class="links-of-author-item">
                  <a href="https://www.jianshu.com/u/03a336dff0ec" target="_blank" title="简书"><i class="fa fa-fw fa-book"></i>简书</a>
                  
                </span>
              
            </div>
          

          
          

          
          

          
            
          
          

        </div>
      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2018</span>
  <span class="with-love" id="animate">
    <i class="fa fa-snowflake-o"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">小马同学</span>

  

  
</div>








  <div class="theme-info">主题 – <a class="theme-link" target="_blank" href="https://theme-next.org">NexT.Muse</a> v6.4.0</div>





<script async src="//dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script>
<span id="busuanzi_container_site_pv">总访问量<span id="busuanzi_value_site_pv"></span>次</span>
<span class="post-meta-divider">|</span>
<span id="busuanzi_container_site_uv">总访客<span id="busuanzi_value_site_uv"></span>人</span>
<span class="post-meta-divider">|</span>


        








        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    
	
    

    
  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>


























  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=6.4.0"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=6.4.0"></script>



  
  

  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=6.4.0"></script>



  

  










  





  

  

  

  

  
  

  

  

  

  

  

</body>
</html>
